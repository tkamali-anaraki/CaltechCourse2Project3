pipeline {
  agent any
  triggers {
    pollSCM '* * * * *'
  }
  stages {
    stage ("CI") {
      stages {
        stage ("Build") {
          steps {
            withCredentials([usernamePassword(credentialsId: 'Dockerhub-System', passwordVariable: 'password-env', usernameVariable: 'username-env')]) {
              sh '''
                echo "${username-env}"
                echo "${password-env}"
                echo "Pull and Build Stage"
                docker build -t nginx-jenkins -f Dockerfile .
              '''
            }
          }
        }
        stage ("Push") {
          steps {
            sh '''
              echo "Push Stage"
              docker login -u ${username-env} -p ${password-env}
            '''
          }
        }
      }
    }
    stage ("CD") {
      stages {
        stage ("Pull product image") {
          steps {
            sh '''
              echo "Pull product image stage"
            '''
          }
        }
        stage ("Deploy") {
          steps {
            sh '''
              echo "Deploy Stage"
            '''
          }
        }
      }
    }
  }
}
