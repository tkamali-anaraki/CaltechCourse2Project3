pipeline {
  agent any
  triggers {
    pollSCM '* * * * *'
  }
  stages {
    stage ("CI") {
      stages {
        stage ("Build") {
          steps {
            withCredentials([usernamePassword(credentialsId: 'Dockerhub-Caltech', passwordVariable: 'passwordvar', usernameVariable: 'usernamevar')]) {
              sh '''
                echo "${usernamevar}"
                echo "${passwordvar}"
                echo "Pull and Build Stage"
                docker build -t nginx-jenkins -f Dockerfile .
              '''
            }
          }
        }
        stage ("Push") {
          steps {
            sh '''
              echo "Push Stage"
              docker login -u ${usernamevar} -p ${passwordvar}
            '''
          }
        }
      }
    }
    stage ("CD") {
      stages {
        stage ("Pull product image") {
          steps {
            sh '''
              echo "Pull product image stage"
            '''
          }
        }
        stage ("Deploy") {
          steps {
            sh '''
              echo "Deploy Stage"
            '''
          }
        }
      }
    }
  }
}
